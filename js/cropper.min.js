!function(a,b){"object"==typeof exports&&"undefined"!=typeof module?module.exports=b():"function"==typeof define&&define.amd?define(b):a.Cropper=b()}(this,function(){"use strict";function Y(a){return"number"==typeof a&&!X(a)}function Z(a){return"undefined"==typeof a}function $(a){return"object"===("undefined"==typeof a?"undefined":T(a))&&null!==a}function ab(a){var b,c;if(!$(a))return!1;try{return b=a.constructor,c=b.prototype,b&&c&&_.call(c,"isPrototypeOf")}catch(d){return!1}}function bb(a){return"function"==typeof a}function cb(a,b){var c,d;if(a&&bb(b))if(Array.isArray(a)||Y(a.length))for(c=a.length,d=void 0,d=0;c>d&&b.call(a,a[d],d,a)!==!1;d+=1);else $(a)&&Object.keys(a).forEach(function(c){b.call(a,a[c],c,a)});return a}function fb(a){var b=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1e11;return eb.test(a)?Math.round(a*b)/b:a}function hb(a,b){var c=a.style;cb(b,function(a,b){gb.test(b)&&Y(a)&&(a+="px"),c[b]=a})}function ib(a,b){return a.classList?a.classList.contains(b):a.className.indexOf(b)>-1}function jb(a,b){if(b){if(Y(a.length))return cb(a,function(a){jb(a,b)}),void 0;if(a.classList)return a.classList.add(b),void 0;var c=a.className.trim();c?c.indexOf(b)<0&&(a.className=c+" "+b):a.className=b}}function kb(a,b){return b?Y(a.length)?(cb(a,function(a){kb(a,b)}),void 0):a.classList?(a.classList.remove(b),void 0):(a.className.indexOf(b)>=0&&(a.className=a.className.replace(b,"")),void 0):void 0}function lb(a,b,c){return b?Y(a.length)?(cb(a,function(a){lb(a,b,c)}),void 0):(c?jb(a,b):kb(a,b),void 0):void 0}function nb(a){return a.replace(mb,"$1-$2").toLowerCase()}function ob(a,b){return $(a[b])?a[b]:a.dataset?a.dataset[b]:a.getAttribute("data-"+nb(b))}function pb(a,b,c){$(c)?a[b]=c:a.dataset?a.dataset[b]=c:a.setAttribute("data-"+nb(b),c)}function qb(a,b){if($(a[b]))try{delete a[b]}catch(c){a[b]=void 0}else if(a.dataset)try{delete a.dataset[b]}catch(c){a.dataset[b]=void 0}else a.removeAttribute("data-"+nb(b))}function tb(a,b,c){var d=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{},e=c;b.trim().split(rb).forEach(function(b){if(!sb){var f=a.listeners;f&&f[b]&&f[b][c]&&(e=f[b][c],delete f[b][c],0===Object.keys(f[b]).length&&delete f[b],0===Object.keys(f).length&&delete a.listeners)}a.removeEventListener(b,e,d)})}function ub(a,b,c){var d=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{},e=c;b.trim().split(rb).forEach(function(b){if(d.once&&!sb){var f=a.listeners,g=void 0===f?{}:f;e=function(){for(var f=arguments.length,h=Array(f),i=0;f>i;i++)h[i]=arguments[i];delete g[b][c],a.removeEventListener(b,e,d),c.apply(a,h)},g[b]||(g[b]={}),g[b][c]&&a.removeEventListener(b,g[b][c],d),g[b][c]=e,a.listeners=g}a.addEventListener(b,e,d)})}function vb(a,b,c){var d=void 0;return bb(Event)&&bb(CustomEvent)?d=new CustomEvent(b,{detail:c,bubbles:!0,cancelable:!0}):(d=document.createEvent("CustomEvent"),d.initCustomEvent(b,!0,!0,c)),a.dispatchEvent(d)}function wb(a){var b=a.getBoundingClientRect();return{left:b.left+(window.pageXOffset-document.documentElement.clientLeft),top:b.top+(window.pageYOffset-document.documentElement.clientTop)}}function zb(a){var b=a.match(yb);return b&&(b[1]!==xb.protocol||b[2]!==xb.hostname||b[3]!==xb.port)}function Ab(a){var b="timestamp="+(new Date).getTime();return a+(-1===a.indexOf("?")?"?":"&")+b}function Bb(a){var h,b=a.rotate,c=a.scaleX,d=a.scaleY,e=a.translateX,f=a.translateY,g=[];return Y(e)&&0!==e&&g.push("translateX("+e+"px)"),Y(f)&&0!==f&&g.push("translateY("+f+"px)"),Y(b)&&0!==b&&g.push("rotate("+b+"deg)"),Y(c)&&1!==c&&g.push("scaleX("+c+")"),Y(d)&&1!==d&&g.push("scaleY("+d+")"),h=g.length?g.join(" "):"none",{WebkitTransform:h,msTransform:h,transform:h}}function Cb(a){var b=db({},a),c=[];return cb(a,function(a,d){delete b[d],cb(b,function(b){var d=Math.abs(a.startX-b.startX),e=Math.abs(a.startY-b.startY),f=Math.abs(a.endX-b.endX),g=Math.abs(a.endY-b.endY),h=Math.sqrt(d*d+e*e),i=Math.sqrt(f*f+g*g),j=(i-h)/h;c.push(j)})}),c.sort(function(a,b){return Math.abs(a)<Math.abs(b)}),c[0]}function Db(a,b){var c=a.pageX,d=a.pageY,e={endX:c,endY:d};return b?e:db({startX:c,startY:d},e)}function Eb(a){var b=0,c=0,d=0;return cb(a,function(a){var e=a.startX,f=a.startY;b+=e,c+=f,d+=1}),b/=d,c/=d,{pageX:b,pageY:c}}function Gb(a){var g,b=a.aspectRatio,c=a.height,d=a.width,e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"contain",f=function(a){return Fb(a)&&a>0};return f(d)&&f(c)?(g=c*b,"contain"===e&&g>d||"cover"===e&&d>g?c=d/b:d=c*b):f(d)?c=d/b:f(c)&&(d=c*b),{width:d,height:c}}function Hb(a){var e,f,g,h,i,b=a.width,c=a.height,d=a.degree;return d=Math.abs(d)%180,90===d?{width:c,height:b}:(e=d%90*Math.PI/180,f=Math.sin(e),g=Math.cos(e),h=b*g+c*f,i=b*f+c*g,d>90?{width:i,height:h}:{width:h,height:i})}function Ib(a,b,c,d){var e=b.aspectRatio,f=b.naturalWidth,g=b.naturalHeight,h=b.rotate,i=void 0===h?0:h,j=b.scaleX,k=void 0===j?1:j,l=b.scaleY,m=void 0===l?1:l,n=c.aspectRatio,o=c.naturalWidth,p=c.naturalHeight,q=d.fillColor,r=void 0===q?"transparent":q,s=d.imageSmoothingEnabled,t=void 0===s?!0:s,u=d.imageSmoothingQuality,v=void 0===u?"low":u,w=d.maxWidth,x=void 0===w?1/0:w,y=d.maxHeight,z=void 0===y?1/0:y,A=d.minWidth,B=void 0===A?0:A,C=d.minHeight,D=void 0===C?0:C,E=document.createElement("canvas"),F=E.getContext("2d"),G=Gb({aspectRatio:n,width:x,height:z}),H=Gb({aspectRatio:n,width:B,height:D},"cover"),I=Math.min(G.width,Math.max(H.width,o)),J=Math.min(G.height,Math.max(H.height,p)),K=Gb({aspectRatio:e,width:x,height:z}),L=Gb({aspectRatio:e,width:B,height:D},"cover"),M=Math.min(K.width,Math.max(L.width,f)),N=Math.min(K.height,Math.max(L.height,g)),O=[-M/2,-N/2,M,N];return E.width=fb(I),E.height=fb(J),F.fillStyle=r,F.fillRect(0,0,I,J),F.save(),F.translate(I/2,J/2),F.rotate(i*Math.PI/180),F.scale(k,m),F.imageSmoothingEnabled=t,F.imageSmoothingQuality=v,F.drawImage.apply(F,[a].concat(W(O.map(function(a){return Math.floor(fb(a))})))),F.restore(),E}function Kb(a,b,c){var d="",e=void 0;for(c+=b,e=b;c>e;e+=1)d+=Jb(a.getUint8(e));return d}function Mb(a){var b=a.replace(Lb,""),c=atob(b),d=new ArrayBuffer(c.length),e=new Uint8Array(d);return cb(e,function(a,b){e[b]=c.charCodeAt(b)}),d}function Nb(a,b){var c=new Uint8Array(a),d="";return cb(c,function(a){d+=Jb(a)}),"data:"+b+";base64,"+btoa(d)}function Ob(a){var g,h,i,j,k,l,m,n,o,b=new DataView(a),c=void 0,d=void 0,e=void 0,f=void 0;if(255===b.getUint8(0)&&216===b.getUint8(1))for(g=b.byteLength,h=2;g>h;){if(255===b.getUint8(h)&&225===b.getUint8(h+1)){e=h;break}h+=1}if(e&&(i=e+4,j=e+10,"Exif"===Kb(b,i,4)&&(k=b.getUint16(j),d=18761===k,(d||19789===k)&&42===b.getUint16(j+2,d)&&(l=b.getUint32(j+4,d),l>=8&&(f=j+l)))),f)for(m=b.getUint16(f,d),n=void 0,o=void 0,o=0;m>o;o+=1)if(n=f+12*o+2,274===b.getUint16(n,d)){n+=8,c=b.getUint16(n,d),b.setUint16(n,1,d);break}return c}function Pb(a){var b=0,c=1,d=1;switch(a){case 2:c=-1;break;case 3:b=-180;break;case 4:d=-1;break;case 5:b=90,d=-1;break;case 6:b=90;break;case 7:b=90,c=-1;break;case 8:b=-90}return{rotate:b,scaleX:c,scaleY:d}}var a="undefined"!=typeof window,b=a?window:{},c="cropper",d="all",e="crop",f="move",g="zoom",h="e",i="w",j="s",k="n",l="ne",m="nw",n="se",o="sw",p=c+"-crop",q=c+"-disabled",r=c+"-hidden",s=c+"-hide",t=c+"-invisible",u=c+"-modal",v=c+"-move",w=c+"Action",x=c+"Preview",y="crop",z="move",A="none",B="crop",C="cropend",D="cropmove",E="cropstart",F="dblclick",G=b.PointerEvent?"pointerdown":"touchstart mousedown",H=b.PointerEvent?"pointermove":"touchmove mousemove",I=b.PointerEvent?"pointerup pointercancel":"touchend touchcancel mouseup",J="ready",K="resize",L="wheel mousewheel DOMMouseScroll",M="zoom",N=/^(?:e|w|s|n|se|sw|ne|nw|all|crop|move|zoom)$/,O=/^data:/,P=/^data:image\/jpeg;base64,/,Q=/^(?:img|canvas)$/i,R={viewMode:0,dragMode:y,aspectRatio:0/0,data:null,preview:"",responsive:!0,restore:!0,checkCrossOrigin:!0,checkOrientation:!0,modal:!0,guides:!0,center:!0,highlight:!0,background:!0,autoCrop:!0,autoCropArea:.8,movable:!0,rotatable:!0,scalable:!0,zoomable:!0,zoomOnTouch:!0,zoomOnWheel:!0,wheelZoomRatio:.1,cropBoxMovable:!0,cropBoxResizable:!0,toggleDragModeOnDblclick:!0,minCanvasWidth:0,minCanvasHeight:0,minCropBoxWidth:0,minCropBoxHeight:0,minContainerWidth:200,minContainerHeight:100,ready:null,cropstart:null,cropmove:null,cropend:null,crop:null,zoom:null},S='<div class="cropper-container" touch-action="none"><div class="cropper-wrap-box"><div class="cropper-canvas"></div></div><div class="cropper-drag-box"></div><div class="cropper-crop-box"><span class="cropper-view-box"></span><span class="cropper-dashed dashed-h"></span><span class="cropper-dashed dashed-v"></span><span class="cropper-center"></span><span class="cropper-face"></span><span class="cropper-line line-e" data-cropper-action="e"></span><span class="cropper-line line-n" data-cropper-action="n"></span><span class="cropper-line line-w" data-cropper-action="w"></span><span class="cropper-line line-s" data-cropper-action="s"></span><span class="cropper-point point-e" data-cropper-action="e"></span><span class="cropper-point point-n" data-cropper-action="n"></span><span class="cropper-point point-w" data-cropper-action="w"></span><span class="cropper-point point-s" data-cropper-action="s"></span><span class="cropper-point point-ne" data-cropper-action="ne"></span><span class="cropper-point point-nw" data-cropper-action="nw"></span><span class="cropper-point point-sw" data-cropper-action="sw"></span><span class="cropper-point point-se" data-cropper-action="se"></span></div></div>',T="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(a){return typeof a}:function(a){return a&&"function"==typeof Symbol&&a.constructor===Symbol&&a!==Symbol.prototype?"symbol":typeof a},U=function(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")},V=function(){function a(a,b){var c,d;for(c=0;c<b.length;c++)d=b[c],d.enumerable=d.enumerable||!1,d.configurable=!0,"value"in d&&(d.writable=!0),Object.defineProperty(a,d.key,d)}return function(b,c,d){return c&&a(b.prototype,c),d&&a(b,d),b}}(),W=function(a){if(Array.isArray(a)){for(var b=0,c=Array(a.length);b<a.length;b++)c[b]=a[b];return c}return Array.from(a)},X=Number.isNaN||b.isNaN,_=Object.prototype.hasOwnProperty,db=Object.assign||function(a){for(var b=arguments.length,c=Array(b>1?b-1:0),d=1;b>d;d++)c[d-1]=arguments[d];return $(a)&&c.length>0&&c.forEach(function(b){$(b)&&Object.keys(b).forEach(function(c){a[c]=b[c]})}),a},eb=/\.\d*(?:0|9){12}\d*$/i,gb=/^(?:width|height|left|top|marginLeft|marginTop)$/,mb=/([a-z\d])([A-Z])/g,rb=/\s\s*/,sb=function(){var d,e,f,c=!1;return a&&(d=!1,e=function(){},f=Object.defineProperty({},"once",{get:function(){return c=!0,d},set:function(a){d=a}}),b.addEventListener("test",e,f),b.removeEventListener("test",e,f)),c}(),xb=b.location,yb=/^(https?:)\/\/([^:\/?#]+):?(\d*)/i,Fb=Number.isFinite||b.isFinite,Jb=String.fromCharCode,Lb=/^data:.*,/,Qb={render:function(){this.initContainer(),this.initCanvas(),this.initCropBox(),this.renderCanvas(),this.cropped&&this.renderCropBox()},initContainer:function(){var e,a=this.element,b=this.options,c=this.container,d=this.cropper;jb(d,r),kb(a,r),e={width:Math.max(c.offsetWidth,Number(b.minContainerWidth)||200),height:Math.max(c.offsetHeight,Number(b.minContainerHeight)||100)},this.containerData=e,hb(d,{width:e.width,height:e.height}),jb(a,r),kb(d,r)},initCanvas:function(){var j,a=this.containerData,b=this.imageData,c=this.options.viewMode,d=90===Math.abs(b.rotate)%180,e=d?b.naturalHeight:b.naturalWidth,f=d?b.naturalWidth:b.naturalHeight,g=e/f,h=a.width,i=a.height;a.height*g>a.width?3===c?h=a.height*g:i=a.width/g:3===c?i=a.width/g:h=a.height*g,j={aspectRatio:g,naturalWidth:e,naturalHeight:f,width:h,height:i},j.left=(a.width-h)/2,j.top=(a.height-i)/2,j.oldLeft=j.left,j.oldTop=j.top,this.canvasData=j,this.limited=1===c||2===c,this.limitCanvas(!0,!0),this.initialImageData=db({},b),this.initialCanvasData=db({},j)},limitCanvas:function(a,b){var j,k,l,m,n,c=this.options,d=this.containerData,e=this.canvasData,f=this.cropBoxData,g=c.viewMode,h=e.aspectRatio,i=this.cropped&&f;a&&(j=Number(c.minCanvasWidth)||0,k=Number(c.minCanvasHeight)||0,g>1?(j=Math.max(j,d.width),k=Math.max(k,d.height),3===g&&(k*h>j?j=k*h:k=j/h)):g>0&&(j?j=Math.max(j,i?f.width:0):k?k=Math.max(k,i?f.height:0):i&&(j=f.width,k=f.height,k*h>j?j=k*h:k=j/h)),l=Gb({aspectRatio:h,width:j,height:k}),j=l.width,k=l.height,e.minWidth=j,e.minHeight=k,e.maxWidth=1/0,e.maxHeight=1/0),b&&(g?(m=d.width-e.width,n=d.height-e.height,e.minLeft=Math.min(0,m),e.minTop=Math.min(0,n),e.maxLeft=Math.max(0,m),e.maxTop=Math.max(0,n),i&&this.limited&&(e.minLeft=Math.min(f.left,f.left+(f.width-e.width)),e.minTop=Math.min(f.top,f.top+(f.height-e.height)),e.maxLeft=f.left,e.maxTop=f.top,2===g&&(e.width>=d.width&&(e.minLeft=Math.min(0,m),e.maxLeft=Math.max(0,m)),e.height>=d.height&&(e.minTop=Math.min(0,n),e.maxTop=Math.max(0,n))))):(e.minLeft=-e.width,e.minTop=-e.height,e.maxLeft=d.width,e.maxTop=d.height))},renderCanvas:function(a,b){var e,f,g,h,i,c=this.canvasData,d=this.imageData;b&&(e=Hb({width:d.naturalWidth*Math.abs(d.scaleX||1),height:d.naturalHeight*Math.abs(d.scaleY||1),degree:d.rotate||0}),f=e.width,g=e.height,h=c.width*(f/c.naturalWidth),i=c.height*(g/c.naturalHeight),c.left-=(h-c.width)/2,c.top-=(i-c.height)/2,c.width=h,c.height=i,c.aspectRatio=f/g,c.naturalWidth=f,c.naturalHeight=g,this.limitCanvas(!0,!1)),(c.width>c.maxWidth||c.width<c.minWidth)&&(c.left=c.oldLeft),(c.height>c.maxHeight||c.height<c.minHeight)&&(c.top=c.oldTop),c.width=Math.min(Math.max(c.width,c.minWidth),c.maxWidth),c.height=Math.min(Math.max(c.height,c.minHeight),c.maxHeight),this.limitCanvas(!1,!0),c.left=Math.min(Math.max(c.left,c.minLeft),c.maxLeft),c.top=Math.min(Math.max(c.top,c.minTop),c.maxTop),c.oldLeft=c.left,c.oldTop=c.top,hb(this.canvas,db({width:c.width,height:c.height},Bb({translateX:c.left,translateY:c.top}))),this.renderImage(a),this.cropped&&this.limited&&this.limitCropBox(!0,!0)},renderImage:function(a){var b=this.canvasData,c=this.imageData,d=c.naturalWidth*(b.width/b.naturalWidth),e=c.naturalHeight*(b.height/b.naturalHeight);db(c,{width:d,height:e,left:(b.width-d)/2,top:(b.height-e)/2}),hb(this.image,db({width:c.width,height:c.height},Bb(db({translateX:c.left,translateY:c.top},c)))),a&&this.output()},initCropBox:function(){var a=this.options,b=this.canvasData,c=a.aspectRatio,d=Number(a.autoCropArea)||.8,e={width:b.width,height:b.height};c&&(b.height*c>b.width?e.height=e.width/c:e.width=e.height*c),this.cropBoxData=e,this.limitCropBox(!0,!0),e.width=Math.min(Math.max(e.width,e.minWidth),e.maxWidth),e.height=Math.min(Math.max(e.height,e.minHeight),e.maxHeight),e.width=Math.max(e.minWidth,e.width*d),e.height=Math.max(e.minHeight,e.height*d),e.left=b.left+(b.width-e.width)/2,e.top=b.top+(b.height-e.height)/2,e.oldLeft=e.left,e.oldTop=e.top,this.initialCropBoxData=db({},e)},limitCropBox:function(a,b){var i,j,k,l,c=this.options,d=this.containerData,e=this.canvasData,f=this.cropBoxData,g=this.limited,h=c.aspectRatio;a&&(i=Number(c.minCropBoxWidth)||0,j=Number(c.minCropBoxHeight)||0,k=Math.min(d.width,g?e.width:d.width),l=Math.min(d.height,g?e.height:d.height),i=Math.min(i,d.width),j=Math.min(j,d.height),h&&(i&&j?j*h>i?j=i/h:i=j*h:i?j=i/h:j&&(i=j*h),l*h>k?l=k/h:k=l*h),f.minWidth=Math.min(i,k),f.minHeight=Math.min(j,l),f.maxWidth=k,f.maxHeight=l),b&&(g?(f.minLeft=Math.max(0,e.left),f.minTop=Math.max(0,e.top),f.maxLeft=Math.min(d.width,e.left+e.width)-f.width,f.maxTop=Math.min(d.height,e.top+e.height)-f.height):(f.minLeft=0,f.minTop=0,f.maxLeft=d.width-f.width,f.maxTop=d.height-f.height))},renderCropBox:function(){var a=this.options,b=this.containerData,c=this.cropBoxData;(c.width>c.maxWidth||c.width<c.minWidth)&&(c.left=c.oldLeft),(c.height>c.maxHeight||c.height<c.minHeight)&&(c.top=c.oldTop),c.width=Math.min(Math.max(c.width,c.minWidth),c.maxWidth),c.height=Math.min(Math.max(c.height,c.minHeight),c.maxHeight),this.limitCropBox(!1,!0),c.left=Math.min(Math.max(c.left,c.minLeft),c.maxLeft),c.top=Math.min(Math.max(c.top,c.minTop),c.maxTop),c.oldLeft=c.left,c.oldTop=c.top,a.movable&&a.cropBoxMovable&&pb(this.face,w,c.width>=b.width&&c.height>=b.height?f:d),hb(this.cropBox,db({width:c.width,height:c.height},Bb({translateX:c.left,translateY:c.top}))),this.cropped&&this.limited&&this.limitCanvas(!0,!0),this.disabled||this.output()},output:function(){this.preview(),vb(this.element,B,this.getData())}},Rb={initPreview:function(){var e,a=this.crossOrigin,b=this.options.preview,c=a?this.crossOriginUrl:this.url,d=document.createElement("img");a&&(d.crossOrigin=a),d.src=c,this.viewBox.appendChild(d),this.viewBoxImage=d,b&&(e=b,"string"==typeof b?e=this.element.ownerDocument.querySelectorAll(b):b.querySelector&&(e=[b]),this.previews=e,cb(e,function(b){var d=document.createElement("img");pb(b,x,{width:b.offsetWidth,height:b.offsetHeight,html:b.innerHTML}),a&&(d.crossOrigin=a),d.src=c,d.style.cssText='display:block;width:100%;height:auto;min-width:0!important;min-height:0!important;max-width:none!important;max-height:none!important;image-orientation:0deg!important;"',b.innerHTML="",b.appendChild(d)}))},resetPreview:function(){cb(this.previews,function(a){var b=ob(a,x);hb(a,{width:b.width,height:b.height}),a.innerHTML=b.html,qb(a,x)})},preview:function(){var a=this.imageData,b=this.canvasData,c=this.cropBoxData,d=c.width,e=c.height,f=a.width,g=a.height,h=c.left-b.left-a.left,i=c.top-b.top-a.top;this.cropped&&!this.disabled&&(hb(this.viewBoxImage,db({width:f,height:g},Bb(db({translateX:-h,translateY:-i},a)))),cb(this.previews,function(b){var c=ob(b,x),j=c.width,k=c.height,l=j,m=k,n=1;d&&(n=j/d,m=e*n),e&&m>k&&(n=k/e,l=d*n,m=k),hb(b,{width:l,height:m}),hb(b.getElementsByTagName("img")[0],db({width:f*n,height:g*n},Bb(db({translateX:-h*n,translateY:-i*n},a))))}))}},Sb={bind:function(){var a=this.element,b=this.options,c=this.cropper;bb(b.cropstart)&&ub(a,E,b.cropstart),bb(b.cropmove)&&ub(a,D,b.cropmove),bb(b.cropend)&&ub(a,C,b.cropend),bb(b.crop)&&ub(a,B,b.crop),bb(b.zoom)&&ub(a,M,b.zoom),ub(c,G,this.onCropStart=this.cropStart.bind(this)),b.zoomable&&b.zoomOnWheel&&ub(c,L,this.onWheel=this.wheel.bind(this)),b.toggleDragModeOnDblclick&&ub(c,F,this.onDblclick=this.dblclick.bind(this)),ub(a.ownerDocument,H,this.onCropMove=this.cropMove.bind(this)),ub(a.ownerDocument,I,this.onCropEnd=this.cropEnd.bind(this)),b.responsive&&ub(window,K,this.onResize=this.resize.bind(this))},unbind:function(){var a=this.element,b=this.options,c=this.cropper;bb(b.cropstart)&&tb(a,E,b.cropstart),bb(b.cropmove)&&tb(a,D,b.cropmove),bb(b.cropend)&&tb(a,C,b.cropend),bb(b.crop)&&tb(a,B,b.crop),bb(b.zoom)&&tb(a,M,b.zoom),tb(c,G,this.onCropStart),b.zoomable&&b.zoomOnWheel&&tb(c,L,this.onWheel),b.toggleDragModeOnDblclick&&tb(c,F,this.onDblclick),tb(a.ownerDocument,H,this.onCropMove),tb(a.ownerDocument,I,this.onCropEnd),b.responsive&&tb(window,K,this.onResize)}},Tb={resize:function(){var f,g,h,a=this.options,b=this.container,c=this.containerData,d=Number(a.minContainerWidth)||200,e=Number(a.minContainerHeight)||100;this.disabled||c.width<=d||c.height<=e||(f=b.offsetWidth/c.width,(1!==f||b.offsetHeight!==c.height)&&(g=void 0,h=void 0,a.restore&&(g=this.getCanvasData(),h=this.getCropBoxData()),this.render(),a.restore&&(this.setCanvasData(cb(g,function(a,b){g[b]=a*f})),this.setCropBoxData(cb(h,function(a,b){h[b]=a*f})))))},dblclick:function(){this.disabled||this.options.dragMode===A||this.setDragMode(ib(this.dragBox,p)?z:y)},wheel:function(a){var b=this,c=Number(this.options.wheelZoomRatio)||.1,d=1;this.disabled||(a.preventDefault(),this.wheeling||(this.wheeling=!0,setTimeout(function(){b.wheeling=!1},50),a.deltaY?d=a.deltaY>0?1:-1:a.wheelDelta?d=-a.wheelDelta/120:a.detail&&(d=a.detail>0?1:-1),this.zoom(-d*c,a)))},cropStart:function(a){var b,c,d;this.disabled||(b=this.options,c=this.pointers,d=void 0,a.changedTouches?cb(a.changedTouches,function(a){c[a.identifier]=Db(a)}):c[a.pointerId||0]=Db(a),d=Object.keys(c).length>1&&b.zoomable&&b.zoomOnTouch?g:ob(a.target,w),N.test(d)&&vb(this.element,E,{originalEvent:a,action:d})!==!1&&(a.preventDefault(),this.action=d,this.cropping=!1,d===e&&(this.cropping=!0,jb(this.dragBox,u))))},cropMove:function(a){var c,b=this.action;!this.disabled&&b&&(c=this.pointers,a.preventDefault(),vb(this.element,D,{originalEvent:a,action:b})!==!1&&(a.changedTouches?cb(a.changedTouches,function(a){db(c[a.identifier],Db(a,!0))}):db(c[a.pointerId||0],Db(a,!0)),this.change(a)))},cropEnd:function(a){if(!this.disabled){var b=this.action,c=this.pointers;a.changedTouches?cb(a.changedTouches,function(a){delete c[a.identifier]}):delete c[a.pointerId||0],b&&(a.preventDefault(),Object.keys(c).length||(this.action=""),this.cropping&&(this.cropping=!1,lb(this.dragBox,u,this.cropped&&this.options.modal)),vb(this.element,C,{originalEvent:a,action:b}))}}},Ub={change:function(a){var H,I,J,b=this.options,c=this.canvasData,p=this.containerData,q=this.cropBoxData,s=this.pointers,t=this.action,u=b.aspectRatio,v=q.left,w=q.top,x=q.width,y=q.height,z=v+x,A=w+y,B=0,C=0,D=p.width,E=p.height,F=!0,G=void 0;switch(!u&&a.shiftKey&&(u=x&&y?x/y:1),this.limited&&(B=q.minLeft,C=q.minTop,D=B+Math.min(p.width,c.width,c.left+c.width),E=C+Math.min(p.height,c.height,c.top+c.height)),H=s[Object.keys(s)[0]],I={x:H.endX-H.startX,y:H.endY-H.startY},J=function(a){switch(a){case h:z+I.x>D&&(I.x=D-z);break;case i:v+I.x<B&&(I.x=B-v);break;case k:w+I.y<C&&(I.y=C-w);break;case j:A+I.y>E&&(I.y=E-A)}},t){case d:v+=I.x,w+=I.y;break;case h:if(I.x>=0&&(z>=D||u&&(C>=w||A>=E))){F=!1;break}J(h),x+=I.x,u&&(y=x/u,w-=I.x/u/2),0>x&&(t=i,x=0);break;case k:if(I.y<=0&&(C>=w||u&&(B>=v||z>=D))){F=!1;break}J(k),y-=I.y,w+=I.y,u&&(x=y*u,v+=I.y*u/2),0>y&&(t=j,y=0);break;case i:if(I.x<=0&&(B>=v||u&&(C>=w||A>=E))){F=!1;break}J(i),x-=I.x,v+=I.x,u&&(y=x/u,w+=I.x/u/2),0>x&&(t=h,x=0);break;case j:if(I.y>=0&&(A>=E||u&&(B>=v||z>=D))){F=!1;break}J(j),y+=I.y,u&&(x=y*u,v-=I.y*u/2),0>y&&(t=k,y=0);break;case l:if(u){if(I.y<=0&&(C>=w||z>=D)){F=!1;break}J(k),y-=I.y,w+=I.y,x=y*u}else J(k),J(h),I.x>=0?D>z?x+=I.x:I.y<=0&&C>=w&&(F=!1):x+=I.x,I.y<=0?w>C&&(y-=I.y,w+=I.y):(y-=I.y,w+=I.y);0>x&&0>y?(t=o,y=0,x=0):0>x?(t=m,x=0):0>y&&(t=n,y=0);break;case m:if(u){if(I.y<=0&&(C>=w||B>=v)){F=!1;break}J(k),y-=I.y,w+=I.y,x=y*u,v+=I.y*u}else J(k),J(i),I.x<=0?v>B?(x-=I.x,v+=I.x):I.y<=0&&C>=w&&(F=!1):(x-=I.x,v+=I.x),I.y<=0?w>C&&(y-=I.y,w+=I.y):(y-=I.y,w+=I.y);0>x&&0>y?(t=n,y=0,x=0):0>x?(t=l,x=0):0>y&&(t=o,y=0);break;case o:if(u){if(I.x<=0&&(B>=v||A>=E)){F=!1;break}J(i),x-=I.x,v+=I.x,y=x/u}else J(j),J(i),I.x<=0?v>B?(x-=I.x,v+=I.x):I.y>=0&&A>=E&&(F=!1):(x-=I.x,v+=I.x),I.y>=0?E>A&&(y+=I.y):y+=I.y;0>x&&0>y?(t=l,y=0,x=0):0>x?(t=n,x=0):0>y&&(t=m,y=0);break;case n:if(u){if(I.x>=0&&(z>=D||A>=E)){F=!1;break}J(h),x+=I.x,y=x/u}else J(j),J(h),I.x>=0?D>z?x+=I.x:I.y>=0&&A>=E&&(F=!1):x+=I.x,I.y>=0?E>A&&(y+=I.y):y+=I.y;0>x&&0>y?(t=m,y=0,x=0):0>x?(t=o,x=0):0>y&&(t=l,y=0);break;case f:this.move(I.x,I.y),F=!1;break;case g:this.zoom(Cb(s),a),F=!1;break;case e:if(!I.x||!I.y){F=!1;break}G=wb(this.cropper),v=H.startX-G.left,w=H.startY-G.top,x=q.minWidth,y=q.minHeight,I.x>0?t=I.y>0?n:l:I.x<0&&(v-=x,t=I.y>0?o:m),I.y<0&&(w-=y),this.cropped||(kb(this.cropBox,r),this.cropped=!0,this.limited&&this.limitCropBox(!0,!0))}F&&(q.width=x,q.height=y,q.left=v,q.top=w,this.action=t,this.renderCropBox()),cb(s,function(a){a.startX=a.endX,a.startY=a.endY})}},Vb={crop:function(){return!this.ready||this.cropped||this.disabled||(this.cropped=!0,this.limitCropBox(!0,!0),this.options.modal&&jb(this.dragBox,u),kb(this.cropBox,r),this.setCropBoxData(this.initialCropBoxData)),this},reset:function(){return this.ready&&!this.disabled&&(this.imageData=db({},this.initialImageData),this.canvasData=db({},this.initialCanvasData),this.cropBoxData=db({},this.initialCropBoxData),this.renderCanvas(),this.cropped&&this.renderCropBox()),this},clear:function(){return this.cropped&&!this.disabled&&(db(this.cropBoxData,{left:0,top:0,width:0,height:0}),this.cropped=!1,this.renderCropBox(),this.limitCanvas(!0,!0),this.renderCanvas(),kb(this.dragBox,u),jb(this.cropBox,r)),this},replace:function(a){var b=arguments.length>1&&void 0!==arguments[1]?arguments[1]:!1;return!this.disabled&&a&&(this.isImg&&(this.element.src=a),b?(this.url=a,this.image.src=a,this.ready&&(this.viewBoxImage.src=a,cb(this.previews,function(b){b.getElementsByTagName("img")[0].src=a}))):(this.isImg&&(this.replaced=!0),this.options.data=null,this.uncreate(),this.load(a))),this},enable:function(){return this.ready&&this.disabled&&(this.disabled=!1,kb(this.cropper,q)),this},disable:function(){return this.ready&&!this.disabled&&(this.disabled=!0,jb(this.cropper,q)),this},destroy:function(){var a=this.element;return ob(a,c)?(this.isImg&&this.replaced&&(a.src=this.originalUrl),this.uncreate(),qb(a,c),this):this},move:function(a){var b=arguments.length>1&&void 0!==arguments[1]?arguments[1]:a,c=this.canvasData,d=c.left,e=c.top;return this.moveTo(Z(a)?a:d+Number(a),Z(b)?b:e+Number(b))},moveTo:function(a){var b=arguments.length>1&&void 0!==arguments[1]?arguments[1]:a,c=this.canvasData,d=!1;return a=Number(a),b=Number(b),this.ready&&!this.disabled&&this.options.movable&&(Y(a)&&(c.left=a,d=!0),Y(b)&&(c.top=b,d=!0),d&&this.renderCanvas(!0)),this},zoom:function(a,b){var c=this.canvasData;return a=Number(a),a=0>a?1/(1-a):1+a,this.zoomTo(c.width*a/c.naturalWidth,null,b)},zoomTo:function(a,b,c){var j,k,l,m,n,d=this.options,e=this.canvasData,f=e.width,g=e.height,h=e.naturalWidth,i=e.naturalHeight;if(a=Number(a),a>=0&&this.ready&&!this.disabled&&d.zoomable){if(j=h*a,k=i*a,vb(this.element,M,{originalEvent:c,oldRatio:f/h,ratio:j/h})===!1)return this;c?(l=this.pointers,m=wb(this.cropper),n=l&&Object.keys(l).length?Eb(l):{pageX:c.pageX,pageY:c.pageY},e.left-=(j-f)*((n.pageX-m.left-e.left)/f),e.top-=(k-g)*((n.pageY-m.top-e.top)/g)):ab(b)&&Y(b.x)&&Y(b.y)?(e.left-=(j-f)*((b.x-e.left)/f),e.top-=(k-g)*((b.y-e.top)/g)):(e.left-=(j-f)/2,e.top-=(k-g)/2),e.width=j,e.height=k,this.renderCanvas(!0)}return this},rotate:function(a){return this.rotateTo((this.imageData.rotate||0)+Number(a))},rotateTo:function(a){return a=Number(a),Y(a)&&this.ready&&!this.disabled&&this.options.rotatable&&(this.imageData.rotate=a%360,this.renderCanvas(!0,!0)),this},scaleX:function(a){var b=this.imageData.scaleY;return this.scale(a,Y(b)?b:1)},scaleY:function(a){var b=this.imageData.scaleX;return this.scale(Y(b)?b:1,a)},scale:function(a){var b=arguments.length>1&&void 0!==arguments[1]?arguments[1]:a,c=this.imageData,d=!1;return a=Number(a),b=Number(b),this.ready&&!this.disabled&&this.options.scalable&&(Y(a)&&(c.scaleX=a,d=!0),Y(b)&&(c.scaleY=b,d=!0),d&&this.renderCanvas(!0,!0)),this},getData:function(){var g,a=arguments.length>0&&void 0!==arguments[0]?arguments[0]:!1,b=this.options,c=this.imageData,d=this.canvasData,e=this.cropBoxData,f=void 0;return this.ready&&this.cropped?(f={x:e.left-d.left,y:e.top-d.top,width:e.width,height:e.height},g=c.width/c.naturalWidth,cb(f,function(b,c){b/=g,f[c]=a?Math.round(b):b})):f={x:0,y:0,width:0,height:0},b.rotatable&&(f.rotate=c.rotate||0),b.scalable&&(f.scaleX=c.scaleX||1,f.scaleY=c.scaleY||1),f},setData:function(a){var f,g,b=this.options,c=this.imageData,d=this.canvasData,e={};return this.ready&&!this.disabled&&ab(a)&&(f=!1,b.rotatable&&Y(a.rotate)&&a.rotate!==c.rotate&&(c.rotate=a.rotate,f=!0),b.scalable&&(Y(a.scaleX)&&a.scaleX!==c.scaleX&&(c.scaleX=a.scaleX,f=!0),Y(a.scaleY)&&a.scaleY!==c.scaleY&&(c.scaleY=a.scaleY,f=!0)),f&&this.renderCanvas(!0,!0),g=c.width/c.naturalWidth,Y(a.x)&&(e.left=a.x*g+d.left),Y(a.y)&&(e.top=a.y*g+d.top),Y(a.width)&&(e.width=a.width*g),Y(a.height)&&(e.height=a.height*g),this.setCropBoxData(e)),this},getContainerData:function(){return this.ready?db({},this.containerData):{}},getImageData:function(){return this.sized?db({},this.imageData):{}},getCanvasData:function(){var a=this.canvasData,b={};return this.ready&&cb(["left","top","width","height","naturalWidth","naturalHeight"],function(c){b[c]=a[c]}),b},setCanvasData:function(a){var b=this.canvasData,c=b.aspectRatio;return this.ready&&!this.disabled&&ab(a)&&(Y(a.left)&&(b.left=a.left),Y(a.top)&&(b.top=a.top),Y(a.width)?(b.width=a.width,b.height=a.width/c):Y(a.height)&&(b.height=a.height,b.width=a.height*c),this.renderCanvas(!0)),this},getCropBoxData:function(){var a=this.cropBoxData,b=void 0;return this.ready&&this.cropped&&(b={left:a.left,top:a.top,width:a.width,height:a.height}),b||{}},setCropBoxData:function(a){var b=this.cropBoxData,c=this.options.aspectRatio,d=void 0,e=void 0;return this.ready&&this.cropped&&!this.disabled&&ab(a)&&(Y(a.left)&&(b.left=a.left),Y(a.top)&&(b.top=a.top),Y(a.width)&&a.width!==b.width&&(d=!0,b.width=a.width),Y(a.height)&&a.height!==b.height&&(e=!0,b.height=a.height),c&&(d?b.height=b.width/c:e&&(b.width=b.height*c)),this.renderCropBox()),this},getCroppedCanvas:function(){var b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x,y,z,A,B,C,D,E,F,a=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return this.ready&&window.HTMLCanvasElement?(b=this.canvasData,c=Ib(this.image,this.imageData,b,a),this.cropped?(d=this.getData(),e=d.x,f=d.y,g=d.width,h=d.height,i=c.width/Math.floor(b.naturalWidth),1!==i&&(e*=i,f*=i,g*=i,h*=i),j=g/h,k=Gb({aspectRatio:j,width:a.maxWidth||1/0,height:a.maxHeight||1/0}),l=Gb({aspectRatio:j,width:a.minWidth||0,height:a.minHeight||0},"cover"),m=Gb({aspectRatio:j,width:a.width||(1!==i?c.width:g),height:a.height||(1!==i?c.height:h)}),n=m.width,o=m.height,n=Math.min(k.width,Math.max(l.width,n)),o=Math.min(k.height,Math.max(l.height,o)),p=document.createElement("canvas"),q=p.getContext("2d"),p.width=fb(n),p.height=fb(o),q.fillStyle=a.fillColor||"transparent",q.fillRect(0,0,n,o),r=a.imageSmoothingEnabled,s=void 0===r?!0:r,t=a.imageSmoothingQuality,q.imageSmoothingEnabled=s,t&&(q.imageSmoothingQuality=t),u=c.width,v=c.height,w=e,x=f,y=void 0,z=void 0,A=void 0,B=void 0,C=void 0,D=void 0,-g>=w||w>u?(w=0,y=0,A=0,C=0):0>=w?(A=-w,w=0,y=Math.min(u,g+w),C=y):u>=w&&(A=0,y=Math.min(g,u-w),C=y),0>=y||-h>=x||x>v?(x=0,z=0,B=0,D=0):0>=x?(B=-x,x=0,z=Math.min(v,h+x),D=z):v>=x&&(B=0,z=Math.min(h,v-x),D=z),E=[w,x,y,z],C>0&&D>0&&(F=n/g,E.push(A*F,B*F,C*F,D*F)),q.drawImage.apply(q,[c].concat(W(E.map(function(a){return Math.floor(fb(a))})))),p):c):null},setAspectRatio:function(a){var b=this.options;return this.disabled||Z(a)||(b.aspectRatio=Math.max(0,a)||0/0,this.ready&&(this.initCropBox(),this.cropped&&this.renderCropBox())),this},setDragMode:function(a){var e,f,b=this.options,c=this.dragBox,d=this.face;return this.ready&&!this.disabled&&(e=a===y,f=b.movable&&a===z,a=e||f?a:A,b.dragMode=a,pb(c,w,a),lb(c,p,e),lb(c,v,f),b.cropBoxMovable||(pb(d,w,a),lb(d,p,e),lb(d,v,f))),this}},Wb=b.Cropper,Xb=function(){function a(b){var c=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};if(U(this,a),!b||!Q.test(b.tagName))throw new Error("The first argument is required and must be an <img> or <canvas> element.");this.element=b,this.options=db({},R,ab(c)&&c),this.cropped=!1,this.disabled=!1,this.pointers={},this.ready=!1,this.reloading=!1,this.replaced=!1,this.sized=!1,this.sizing=!1,this.init()}return V(a,[{key:"init",value:function(){var a=this.element,b=a.tagName.toLowerCase(),d=void 0;if(!ob(a,c)){if(pb(a,c,this),"img"===b){if(this.isImg=!0,d=a.getAttribute("src")||"",this.originalUrl=d,!d)return;d=a.src}else"canvas"===b&&window.HTMLCanvasElement&&(d=a.toDataURL());this.load(d)}}},{key:"load",value:function(a){var c,d,e,f,b=this;if(a){if(this.url=a,this.imageData={},c=this.element,d=this.options,!d.checkOrientation||!window.ArrayBuffer)return this.clone(),void 0;if(O.test(a))return P.test(a)?this.read(Mb(a)):this.clone(),void 0;e=new XMLHttpRequest,this.reloading=!0,this.xhr=e,f=function(){b.reloading=!1,b.xhr=null},e.ontimeout=f,e.onabort=f,e.onerror=function(){f(),b.clone()},e.onload=function(){f(),b.read(e.response)},d.checkCrossOrigin&&zb(a)&&c.crossOrigin&&(a=Ab(a)),e.open("get",a),e.responseType="arraybuffer",e.withCredentials="use-credentials"===c.crossOrigin,e.send()}}},{key:"read",value:function(a){var h,b=this.options,c=this.imageData,d=Ob(a),e=0,f=1,g=1;d>1&&(this.url=Nb(a,"image/jpeg"),h=Pb(d),e=h.rotate,f=h.scaleX,g=h.scaleY),b.rotatable&&(c.rotate=e),b.scalable&&(c.scaleX=f,c.scaleY=g),this.clone()
  }},{key:"clone",value:function(){var e,a=this.element,b=this.url,c=void 0,d=void 0;this.options.checkCrossOrigin&&zb(b)&&(c=a.crossOrigin,c?d=b:(c="anonymous",d=Ab(b))),this.crossOrigin=c,this.crossOriginUrl=d,e=document.createElement("img"),c&&(e.crossOrigin=c),e.src=d||b,this.image=e,e.onload=this.start.bind(this),e.onerror=this.stop.bind(this),jb(e,s),a.parentNode.insertBefore(e,a.nextSibling)}},{key:"start",value:function(){var d,e,f,g,a=this,c=this.isImg?this.element:this.image;return c.onload=null,c.onerror=null,this.sizing=!0,d=b.navigator&&/(Macintosh|iPhone|iPod|iPad).*AppleWebKit/i.test(b.navigator.userAgent),e=function(b,c){db(a.imageData,{naturalWidth:b,naturalHeight:c,aspectRatio:b/c}),a.sizing=!1,a.sized=!0,a.build()},c.naturalWidth&&!d?(e(c.naturalWidth,c.naturalHeight),void 0):(f=document.createElement("img"),g=document.body||document.documentElement,this.sizingImage=f,f.onload=function(){e(f.width,f.height),d||g.removeChild(f)},f.src=c.src,d||(f.style.cssText="left:0;max-height:none!important;max-width:none!important;min-height:0!important;min-width:0!important;opacity:0;position:absolute;top:0;z-index:-1;",g.appendChild(f)),void 0)}},{key:"stop",value:function(){var a=this.image;a.onload=null,a.onerror=null,a.parentNode.removeChild(a),this.image=null}},{key:"build",value:function(){var a,b,e,f,g,h,i,j,k,l;this.sized&&!this.ready&&(a=this.element,b=this.options,e=this.image,f=a.parentNode,g=document.createElement("div"),g.innerHTML=S,h=g.querySelector("."+c+"-container"),i=h.querySelector("."+c+"-canvas"),j=h.querySelector("."+c+"-drag-box"),k=h.querySelector("."+c+"-crop-box"),l=k.querySelector("."+c+"-face"),this.container=f,this.cropper=h,this.canvas=i,this.dragBox=j,this.cropBox=k,this.viewBox=h.querySelector("."+c+"-view-box"),this.face=l,i.appendChild(e),jb(a,r),f.insertBefore(h,a.nextSibling),this.isImg||kb(e,s),this.initPreview(),this.bind(),b.aspectRatio=Math.max(0,b.aspectRatio)||0/0,b.viewMode=Math.max(0,Math.min(3,Math.round(b.viewMode)))||0,jb(k,r),b.guides||jb(k.getElementsByClassName(c+"-dashed"),r),b.center||jb(k.getElementsByClassName(c+"-center"),r),b.background&&jb(h,c+"-bg"),b.highlight||jb(l,t),b.cropBoxMovable&&(jb(l,v),pb(l,w,d)),b.cropBoxResizable||(jb(k.getElementsByClassName(c+"-line"),r),jb(k.getElementsByClassName(c+"-point"),r)),this.render(),this.ready=!0,this.setDragMode(b.dragMode),b.autoCrop&&this.crop(),this.setData(b.data),bb(b.ready)&&ub(a,J,b.ready,{once:!0}),vb(a,J))}},{key:"unbuild",value:function(){this.ready&&(this.ready=!1,this.unbind(),this.resetPreview(),this.cropper.parentNode.removeChild(this.cropper),kb(this.element,r))}},{key:"uncreate",value:function(){this.ready?(this.unbuild(),this.ready=!1,this.cropped=!1):this.sizing?(this.sizingImage.onload=null,this.sizing=!1,this.sized=!1):this.reloading?this.xhr.abort():this.image&&this.stop()}}],[{key:"noConflict",value:function(){return window.Cropper=Wb,a}},{key:"setDefaults",value:function(a){db(R,ab(a)&&a)}}]),a}();return db(Xb.prototype,Qb,Rb,Sb,Tb,Ub,Vb),Xb});